<?xml version="1.0" encoding="UTF-8"?>
<launch>
  <!-- Launch file for Livox AVIA LiDAR -->
  <arg name="rviz" default="true" />
  <!--<arg name="config_file" default="$(find fast_lio)/config/mid360.yaml" />-->
  <arg name="config_file" value="$(find clair_alert)/config/fast_lio.yaml" />
  <rosparam command="load" file="$(arg config_file)" />
  <rosparam file="$(find clair_alert)/config/config_ad30.yaml" command="load"/>

  <arg name="if_log_debug_print" default="false" />
  <arg name="if_log_speed_print" default="true" />
  <arg name="if_log_idel_print" default="true" />
  <arg name="if_cropself"  default="true" />
  <arg name="pcd_folder" default="$(find fast_lio)/PCD" />
  <arg name="save_pcd" default="true" />
  <arg name="using_lidar_dirct" default="1" />

  <param name="point_filter_num" type="int" value="3" />
  <param name="max_iteration" type="int" value="3" />
  <param name="filter_size_corner_min" type="double" value="0.05" />
  <param name="filter_size_surf_min" type="double" value="0.1" />
  
  <param name="cube_side_length" type="double" value="2000" />
  <param name="runtime_pos_log_enable" type="bool" value="1" />
  <param name="feature_extract_enable" type="bool" value="1" />

  <param name="pcd_save/pcd_save_en" type="bool" value="1" />
  <param name="pcd_save/interval" type="int" value="1" />
  <param name="pcd_save/folderString" type="string" value="$(arg pcd_folder)" />

  <param name="preprocess/lidar_type" type="int" value="1" />'
  <param name="preprocess/if_cropself" type="bool" value="$(arg if_cropself)" />

  <param name="log/if_log_debug_print" type="bool" value="$(arg if_log_debug_print)" />
  <param name="log/if_log_speed_print" type="bool" value="$(arg if_log_speed_print)" />
  <param name="log/if_log_idel_print" type="bool" value="$(arg if_log_idel_print)" />
  <param name="log/frequency_hz_log_speed" type="double" value="0.2" />
  
  <param name="using_lidar_dirct" type="int"  value="$(arg using_lidar_dirct)" /> <!--FRONT 1, REAR 2-->
  <param name="common/lid_topic"  type="string" value="/sensing/front/livox/lidar" />
  <param name="common/imu_topic"  type="string" value="/sensing/front/livox/imu" />

  <node pkg="fast_lio" type="fastlio_mapping" name="laserMapping" output="log" respawn="true">
    <!--<remap from="$(arg livox_lidar_topic)" to="$(arg livox_lidar_topic)"/>-->
    <remap from="/Odometry"  to="/odom" />
    <remap from="/twist"     to="/twist" />
    <remap from="max_x"  to="/machine/mirror/max_x" />
    <remap from="min_x"  to="/machine/mirror/min_x" />
    <remap from="max_y"  to="/machine/mirror/max_y" />
    <remap from="min_y"  to="/machine/mirror/min_y" />
    <remap from="max_z"  to="/machine/mirror/max_z" />
    <remap from="min_z"  to="/machine/mirror/min_z" /> 
    <remap from="front_lidar_base2lidar" to="/sensorkit/front/ext_base2lidar" />
    <remap from="rear_lidar_base2lidar"  to="/sensorkit/rear/ext_base2lidar" />
  </node>

  <!-- <arg name="front_lidar_frame" default="livox_front" />
  <arg name="front_imu_frame"   default="livox_front" />
  <arg name="rear_lidar_frame"  default="livox_rear" />
  <arg name="rear_imu_frame"    default="livox_rear" />
  

  <arg name="input/lidar0"      default="livox/lidar"/>
  <arg name="base_frame"        default="base_link" />
  <arg name="lidar_frame"       value="$(arg front_lidar_frame)" />

  <group ns="sensing">
    <group ns="front">

      <node pkg="livox_to_points" type="livox_to_points_node" name="livox_to_points_node"
        output="screen">
        <remap from="/livox/lidar" to="$(arg input/lidar0)" />
        <remap from="/livox/points" to="livox/points"/>
      </node> 

      <node pkg="imu_complementary_filter" type="complementary_filter_node"
        name="complementary_filter_gain_node" output="screen">
        <remap from="imu/data_raw" to="livox/imu" />
        <remap from="imu/data" to="imu/imu_data" />
        <param name="acc_g_unit" value="true" />
        <param name="do_bias_estimation" value="true" />
        <param name="do_adaptive_gain" value="true" />
        <param name="use_mag" value="false" />
        <param name="gain_acc" value="0.004" />
        <param name="gain_mag" value="0.01" />
        <param name="bias_alpha" value="0.01" />
        <param name="publish_debug_topics" value="false" />
        <param name="publish_tf" value="false" />
      </node>
    </group>  -->

<!--    <group ns="rear">
      <node pkg="livox_to_points" type="livox_to_points_node" name="livox_to_points_node"
        output="screen">
        <remap from="/livox/lidar" to="$(arg input/lidar0)"/>
        <remap from="/livox/points" to="livox/points" />
      </node>


      <node pkg="imu_complementary_filter" type="complementary_filter_node"
        name="complementary_filter_gain_node" output="screen">
        <remap from="imu/data_raw" to="livox/imu" />
        <remap from="imu/data" to="imu/imu_data" />
        <param name="acc_g_unit" value="true" />
        <param name="do_bias_estimation" value="true" />
        <param name="do_adaptive_gain" value="true" />
        <param name="use_mag" value="false" />
        <param name="gain_acc" value="0.004" />
        <param name="gain_mag" value="0.01" />
        <param name="bias_alpha" value="0.01" />
        <param name="publish_debug_topics" value="false" />
        <param name="publish_tf" value="false" />
      </node>
    </group>
  </group>-->

  <group if="$(arg rviz)">
    <node launch-prefix="nice" pkg="rviz" type="rviz" name="rviz"
      args="-d $(find fast_lio)/rviz_cfg/loam_livox_.rviz">
      <param name="/use_sim_time" value="false" />
    </node>
  </group>

</launch>
